<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrix Product Calculator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for input fields to ensure they are narrow and centered */
        .matrix-input {
            width: 40px; /* Small fixed width for matrix elements */
            height: 40px;
            text-align: center;
            appearance: textfield; /* Remove number arrows in Firefox */
            font-weight: 500;
            border: 1px solid #d1d5db;
        }
        /* Remove number arrows in Chrome/Safari */
        .matrix-input::-webkit-outer-spin-button,
        .matrix-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* Style for the result matrix */
        .result-cell {
            min-width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #d1fae5; /* Light green background */
            font-weight: 700;
            color: #047857; /* Dark green text */
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#4f46e5',
                        'primary-light': '#6366f1',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 font-sans min-h-screen p-4 sm:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 mb-2">Matrix Product Calculator</h1>
            <p class="text-lg text-gray-600">Compute $A \times B$ where $A$ is $m \times n$ and $B$ is $n \times p$.</p>
        </header>

        <!-- Main Calculator Area -->
        <div class="bg-white p-6 sm:p-10 rounded-xl shadow-2xl border border-gray-100">

            <!-- Dimension Controls and Error Message -->
            <div class="space-y-6 mb-8">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0 md:space-x-8">
                    
                    <!-- Matrix A Dimensions -->
                    <div class="flex items-center space-x-2">
                        <label class="text-gray-700 font-semibold whitespace-nowrap">Matrix A ($m \times n$):</label>
                        <input type="number" id="rowsA" value="2" min="1" max="6" oninput="updateMatrices()"
                               class="w-16 p-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                        <span class="text-xl font-bold text-gray-700">x</span>
                        <input type="number" id="colsA" value="2" min="1" max="6" oninput="updateMatrices()"
                               class="w-16 p-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                    </div>
                    
                    <!-- Matrix B Dimensions -->
                    <div class="flex items-center space-x-2">
                        <label class="text-gray-700 font-semibold whitespace-nowrap">Matrix B ($n \times p$):</label>
                        <input type="number" id="rowsB" value="2" min="1" max="6" oninput="updateMatrices()"
                               class="w-16 p-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                        <span class="text-xl font-bold text-gray-700">x</span>
                        <input type="number" id="colsB" value="2" min="1" max="6" oninput="updateMatrices()"
                               class="w-16 p-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
                    </div>

                    <!-- Calculate Button -->
                    <button onclick="calculateProduct()"
                            class="w-full md:w-auto px-6 py-3 bg-primary hover:bg-primary-light text-white font-bold rounded-lg shadow-md transition duration-200">
                        Calculate Product
                    </button>
                </div>

                <!-- Error Message Display -->
                <div id="errorMessage" class="hidden p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg font-medium" role="alert">
                    Dimensions are incompatible for multiplication. Matrix A columns ($n$) must equal Matrix B rows ($n$).
                </div>
            </div>

            <!-- Matrix Input Grids -->
            <div class="flex flex-col lg:flex-row justify-around space-y-8 lg:space-y-0 lg:space-x-8">
                
                <!-- Matrix A Container -->
                <div class="flex-1 bg-gray-50 p-4 rounded-lg border border-gray-200 shadow-inner">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Matrix A</h2>
                    <div id="matrixAContainer" class="overflow-x-auto p-2">
                        <!-- Matrix A inputs will be generated here -->
                    </div>
                </div>

                <div class="flex items-center justify-center text-3xl font-extrabold text-gray-700">
                    $\times$
                </div>

                <!-- Matrix B Container -->
                <div class="flex-1 bg-gray-50 p-4 rounded-lg border border-gray-200 shadow-inner">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Matrix B</h2>
                    <div id="matrixBContainer" class="overflow-x-auto p-2">
                        <!-- Matrix B inputs will be generated here -->
                    </div>
                </div>
            </div>

            <!-- Result Matrix -->
            <div class="mt-12 pt-6 border-t border-gray-200">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Result (Matrix C)</h2>
                <div id="resultContainer" class="p-6 bg-green-50 rounded-lg border-2 border-green-200 min-h-[100px] flex items-center justify-center">
                    <p class="text-gray-500">Press "Calculate Product" to see the result here.</p>
                </div>
            </div>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            updateMatrices();
        });

        // Helper function to create the grid of input elements
        function createMatrixInputs(containerId, rows, cols, prefix) {
            const container = document.getElementById(containerId);
            container.innerHTML = ''; // Clear previous content

            // Set up CSS Grid styling based on the number of columns
            container.style.display = 'grid';
            container.style.gridTemplateColumns = `repeat(${cols}, auto)`;
            container.style.gap = '8px';

            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.id = `${prefix}_${i}_${j}`;
                    input.value = (i === j) ? 1 : 0; // Default to identity-like elements
                    input.classList.add('matrix-input', 'rounded-md', 'focus:ring-2', 'focus:ring-primary', 'focus:border-transparent');
                    container.appendChild(input);
                }
            }
        }

        // Function to update matrix input fields when dimensions change
        function updateMatrices() {
            const rowsA = parseInt(document.getElementById('rowsA').value) || 1;
            const colsA = parseInt(document.getElementById('colsA').value) || 1;
            const rowsB = parseInt(document.getElementById('rowsB').value) || 1;
            const colsB = parseInt(document.getElementById('colsB').value) || 1;

            // Enforce compatibility rule: colsA must equal rowsB (n x n)
            document.getElementById('rowsB').value = colsA;

            createMatrixInputs('matrixAContainer', rowsA, colsA, 'A');
            createMatrixInputs('matrixBContainer', colsA, colsB, 'B');

            // Clear result and hide error on update
            document.getElementById('errorMessage').classList.add('hidden');
            displayResult(null);
        }

        // Helper function to read values from the input fields into a 2D array
        function readMatrix(rows, cols, prefix) {
            const matrix = [];
            for (let i = 0; i < rows; i++) {
                const row = [];
                for (let j = 0; j < cols; j++) {
                    const value = parseFloat(document.getElementById(`${prefix}_${i}_${j}`).value) || 0;
                    row.push(value);
                }
                matrix.push(row);
            }
            return matrix;
        }

        // Core Matrix Multiplication Logic
        function matrixMultiply(A, B) {
            const rowsA = A.length;
            const colsA = A[0].length;
            const rowsB = B.length;
            const colsB = B[0].length;

            // Compatibility check (should be handled by updateMatrices, but good to have)
            if (colsA !== rowsB) {
                return null;
            }

            // Initialize result matrix C (rowsA x colsB)
            const C = Array(rowsA).fill(0).map(() => Array(colsB).fill(0));

            for (let i = 0; i < rowsA; i++) { // rows of A
                for (let j = 0; j < colsB; j++) { // columns of B
                    let sum = 0;
                    for (let k = 0; k < colsA; k++) { // columns of A / rows of B
                        sum += A[i][k] * B[k][j];
                    }
                    C[i][j] = sum;
                }
            }
            return C;
        }

        // Function to display the result matrix
        function displayResult(C) {
            const resultContainer = document.getElementById('resultContainer');
            resultContainer.innerHTML = '';

            if (C === null) {
                // Display error message
                document.getElementById('errorMessage').classList.remove('hidden');
                resultContainer.innerHTML = `<p class="text-gray-500">Press "Calculate Product" to see the result here.</p>`;
                resultContainer.classList.remove('bg-green-50', 'border-green-200');
                resultContainer.classList.add('bg-red-50', 'border-red-200');
                return;
            }
            
            // Display success
            resultContainer.classList.remove('bg-red-50', 'border-red-200');
            resultContainer.classList.add('bg-green-50', 'border-green-200');
            document.getElementById('errorMessage').classList.add('hidden');


            const rowsC = C.length;
            const colsC = C[0].length;

            // Set up CSS Grid styling for the result matrix
            resultContainer.style.display = 'grid';
            resultContainer.style.gridTemplateColumns = `repeat(${colsC}, auto)`;
            resultContainer.style.gap = '8px';
            resultContainer.style.padding = '20px';


            for (let i = 0; i < rowsC; i++) {
                for (let j = 0; j < colsC; j++) {
                    const cell = document.createElement('div');
                    // Use toFixed(2) only if the number is not an integer
                    const displayValue = Number.isInteger(C[i][j]) ? C[i][j] : C[i][j].toFixed(2);
                    cell.textContent = displayValue;
                    cell.classList.add('result-cell', 'rounded-lg', 'shadow-sm');
                    resultContainer.appendChild(cell);
                }
            }
        }

        // Main calculation function triggered by the button
        function calculateProduct() {
            try {
                const rowsA = parseInt(document.getElementById('rowsA').value);
                const colsA = parseInt(document.getElementById('colsA').value);
                const rowsB = parseInt(document.getElementById('rowsB').value);
                const colsB = parseInt(document.getElementById('colsB').value);

                // Re-validate dimensions (A's columns must equal B's rows)
                if (colsA !== rowsB) {
                    displayResult(null); // Triggers error message display
                    return;
                }

                const matrixA = readMatrix(rowsA, colsA, 'A');
                const matrixB = readMatrix(rowsB, colsB, 'B');

                const resultMatrix = matrixMultiply(matrixA, matrixB);

                if (resultMatrix) {
                    displayResult(resultMatrix);
                } else {
                    displayResult(null);
                }
            } catch (error) {
                // Catch any unexpected errors during calculation
                console.error("Calculation Error:", error);
                const resultContainer = document.getElementById('resultContainer');
                resultContainer.innerHTML = `<p class="text-red-700">An unexpected error occurred during calculation.</p>`;
                displayResult(null); // Show dimension error if something goes wrong
            }
        }
    </script>
</body>
</html>
