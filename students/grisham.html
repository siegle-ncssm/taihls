<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gradient Descent Demo</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom CSS for the fixed canvas size and font */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* Light gray background */
        }
        #gdCanvas {
            border: 2px solid #cbd5e1; /* Slate border */
            border-radius: 0.5rem;
            background-color: white;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="p-4 sm:p-8 flex flex-col items-center min-h-screen">

    <div class="w-full max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-900">Gradient Descent Demonstrator</h1>
            <p class="text-lg text-gray-600 mt-2">Visualizing Linear Regression Convergence</p>
        </header>

        <main class="grid lg:grid-cols-3 gap-8">
            <!-- Canvas Plot Area (2/3 width on large screens) -->
            <div class="lg:col-span-2">
                <canvas id="gdCanvas" width="600" height="400" class="w-full h-auto"></canvas>
                <div class="mt-4 p-4 bg-gray-100 rounded-lg shadow-inner">
                    <p class="text-sm text-gray-700">The blue dots are the dataset. The red line represents the current linear model, which moves during each iteration of the gradient descent algorithm to minimize the cost (error).</p>
                </div>
            </div>

            <!-- Controls and Metrics Area (1/3 width on large screens) -->
            <div class="lg:col-span-1 space-y-6">

                <!-- Metrics Card -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-indigo-100">
                    <h2 class="text-xl font-semibold mb-4 text-indigo-700">Model Performance</h2>
                    <div class="space-y-2 text-sm">
                        <p class="flex justify-between items-center text-gray-700">
                            <span class="font-medium">Iteration:</span>
                            <span id="iterationCount" class="font-bold text-indigo-600">0</span>
                        </p>
                        <p class="flex justify-between items-center text-gray-700">
                            <span class="font-medium">Current Cost ($$J(\theta)$$):</span>
                            <span id="currentCost" class="font-bold text-red-600">N/A</span>
                        </p>
                    </div>
                </div>

                <!-- Parameters Card -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-purple-100">
                    <h2 class="text-xl font-semibold mb-4 text-purple-700">Current Parameters</h2>
                    <div class="space-y-2 text-sm">
                        <p class="flex justify-between items-center text-gray-700">
                            <span class="font-medium">Intercept ($$\theta_0$$):</span>
                            <span id="theta0" class="font-mono text-purple-600">0.000</span>
                        </p>
                        <p class="flex justify-between items-center text-gray-700">
                            <span class="font-medium">Slope ($$\theta_1$$):</span>
                            <span id="theta1" class="font-mono text-purple-600">0.000</span>
                        </p>
                    </div>
                </div>

                <!-- Controls -->
                <div class="bg-white p-6 rounded-xl shadow-lg border border-green-100">
                    <h2 class="text-xl font-semibold mb-4 text-green-700">Controls</h2>
                    <button id="toggleButton" class="w-full py-3 px-4 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition duration-150 shadow-md">
                        Start Descent
                    </button>
                    <button id="resetButton" class="w-full mt-3 py-2 px-4 bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium rounded-lg transition duration-150">
                        Reset
                    </button>
                    <p class="text-xs text-center text-gray-500 mt-4">Learning Rate ($\alpha$): 0.01</p>
                </div>

            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('gdCanvas');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // --- DATA and Model Setup ---
            // Simple linear dataset (y â‰ˆ 2x + 4) with some noise
            const X = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
            const Y = [5.5, 7.2, 9.8, 12.1, 13.5, 15.9, 17.0, 20.1, 22.0, 23.9];
            const m = X.length; // Number of training examples

            // Scaling factors for visualization (to fit data into the 600x400 canvas)
            const padding = 40;
            const xMax = Math.max(...X);
            const yMax = Math.max(...Y);
            const xOffset = width - 2 * padding;
            const yOffset = height - 2 * padding;
            const xScale = xOffset / xMax;
            const yScale = yOffset / yMax;

            // Model Parameters (Theta)
            let theta0 = 0.0; // Intercept
            let theta1 = 0.0; // Slope
            let learningRate = 0.01; // Alpha (Controls step size)
            let iteration = 0;
            let isRunning = false;
            let animationFrameId = null;

            // --- UI Elements ---
            const iterationCountEl = document.getElementById('iterationCount');
            const currentCostEl = document.getElementById('currentCost');
            const theta0El = document.getElementById('theta0');
            const theta1El = document.getElementById('theta1');
            const toggleButton = document.getElementById('toggleButton');
            const resetButton = document.getElementById('resetButton');

            // --- Core Gradient Descent Functions ---

            /**
             * Calculates the hypothesis (predicted Y) for a given X.
             * @param {number} x - The input value.
             * @returns {number} The predicted output value.
             */
            function hypothesis(x) {
                return theta0 + theta1 * x;
            }

            /**
             * Calculates the Mean Squared Error cost.
             * @returns {number} The cost J(theta).
             */
            function costFunction() {
                let sumOfSquaredErrors = 0;
                for (let i = 0; i < m; i++) {
                    const error = hypothesis(X[i]) - Y[i];
                    sumOfSquaredErrors += error * error;
                }
                return sumOfSquaredErrors / (2 * m);
            }

            /**
             * Performs one step of gradient descent to update theta0 and theta1.
             */
            function gradientDescentStep() {
                let dJ_dTheta0 = 0; // Derivative of Cost J w.r.t theta0
                let dJ_dTheta1 = 0; // Derivative of Cost J w.r.t theta1

                // Calculate the sum of errors for both derivatives
                for (let i = 0; i < m; i++) {
                    const error = hypothesis(X[i]) - Y[i];
                    dJ_dTheta0 += error;
                    dJ_dTheta1 += error * X[i];
                }

                // Simultaneous update of parameters
                const newTheta0 = theta0 - learningRate * (dJ_dTheta0 / m);
                const newTheta1 = theta1 - learningRate * (dJ_dTheta1 / m);

                theta0 = newTheta0;
                theta1 = newTheta1;
                iteration++;
            }

            // --- Visualization Functions ---

            /**
             * Converts data X coordinate to canvas x pixel coordinate.
             * @param {number} xData - The data value.
             * @returns {number} The pixel position.
             */
            function toCanvasX(xData) {
                return padding + xData * xScale;
            }

            /**
             * Converts data Y coordinate to canvas y pixel coordinate (inverted for canvas).
             * @param {number} yData - The data value.
             * @returns {number} The pixel position.
             */
            function toCanvasY(yData) {
                // Invert Y axis: height - padding - (data * scale)
                return height - padding - yData * yScale;
            }

            /**
             * Draws the entire scene: axes, data points, and the current regression line.
             */
            function draw() {
                // Clear canvas
                ctx.clearRect(0, 0, width, height);

                // 1. Draw Axes
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 1;
                ctx.beginPath();
                // X-axis
                ctx.moveTo(padding, height - padding);
                ctx.lineTo(width - padding, height - padding);
                // Y-axis
                ctx.moveTo(padding, height - padding);
                ctx.lineTo(padding, padding);
                ctx.stroke();

                // 2. Draw Data Points (Blue Dots)
                ctx.fillStyle = '#3b82f6'; // Tailwind blue-500
                X.forEach((x, i) => {
                    const cx = toCanvasX(x);
                    const cy = toCanvasY(Y[i]);
                    ctx.beginPath();
                    ctx.arc(cx, cy, 4, 0, Math.PI * 2);
                    ctx.fill();
                });

                // 3. Draw Current Regression Line (Red Line)
                ctx.strokeStyle = '#ef4444'; // Tailwind red-500
                ctx.lineWidth = 3;
                ctx.beginPath();

                // Start line at X=0
                ctx.moveTo(toCanvasX(0), toCanvasY(hypothesis(0)));
                
                // End line at X=xMax
                ctx.lineTo(toCanvasX(xMax), toCanvasY(hypothesis(xMax)));
                ctx.stroke();

                // 4. Update UI Metrics
                iterationCountEl.textContent = iteration.toLocaleString();
                currentCostEl.textContent = costFunction().toFixed(4);
                theta0El.textContent = theta0.toFixed(3);
                theta1El.textContent = theta1.toFixed(3);
            }

            /**
             * The main animation loop.
             */
            function animate() {
                if (!isRunning) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                    return;
                }

                // Run a few steps per frame for faster visualization
                for(let i = 0; i < 5; i++) {
                    gradientDescentStep();
                }

                draw();

                // Stop if the cost is nearly zero or iterations are too high
                if (costFunction() < 0.001 || iteration >= 10000) {
                    toggleDescent(false);
                } else {
                    animationFrameId = requestAnimationFrame(animate);
                }
            }

            /**
             * Toggles the running state of the descent.
             * @param {boolean} start - True to start, False to stop.
             */
            function toggleDescent(start) {
                isRunning = start;
                toggleButton.textContent = isRunning ? 'Pause Descent' : 'Start Descent';
                toggleButton.classList.toggle('bg-green-500', !isRunning);
                toggleButton.classList.toggle('hover:bg-green-600', !isRunning);
                toggleButton.classList.toggle('bg-orange-500', isRunning);
                toggleButton.classList.toggle('hover:bg-orange-600', isRunning);
                if (isRunning && !animationFrameId) {
                    animate();
                }
            }

            /**
             * Resets all parameters and state.
             */
            function resetModel() {
                toggleDescent(false);
                theta0 = 0.0;
                theta1 = 0.0;
                iteration = 0;
                draw();
                toggleButton.textContent = 'Start Descent';
                // Reset button colors
                toggleButton.classList.remove('bg-orange-500', 'hover:bg-orange-600');
                toggleButton.classList.add('bg-green-500', 'hover:bg-green-600');
            }

            // --- Event Listeners ---
            toggleButton.addEventListener('click', () => {
                toggleDescent(!isRunning);
            });

            resetButton.addEventListener('click', resetModel);

            // Initial draw before starting
            resetModel();
        });
    </script>
</body>
</html>
